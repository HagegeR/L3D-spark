<!DOCTYPE html lang="en">
<html>
<head>
    <title>L3D Cube JS Streaming</title>
    <script src="js/jquery-1.11.0.min.js" type="text/javascript"></script>
    <script src="js/l3dcube.js" type="text/javascript"></script>
</head>
<body>
    <h1>Status: </h1><h2 id="status">disconnected</h2>
    <p>Device ID:</p><input id="device"></input>
    <p>Access token:</p><input type="password" id="token"></input>
    <button id="connect">Connect</button>
    <p>IP Address: </p><p id="ip"></p>

    <script type="text/javascript">
        if(!("WebSocket" in window))
            alert("WebSocket NOT supported by your Browser!");

        function connect(address) {
            console.log("connecting to", address);
            cube = new Cube(address);

            cube.onrefresh = function(cube) {
                cube.background(255, 255, 255);
            }

            cube.onopen = function(cube) {
                console.log("Connected!");
                $("#status").text("Connected");
            }

            cube.onclose = function(cube) {
                console.log("Disconnected.");
            }
        }

        $("#connect").on("click", function() {
            var deviceID = $("#device").val();
            var token = $("#token").val();
            var port = 2525;

            if(token != "") {
                $.get("https://api.spark.io/v1/devices/" + deviceID + "/ip?access_token=" + token, function(data) {
                    var ip = data["result"];
                    $("#ip").text(ip);
                    var address = "ws://" + ip + ":" + port;
                    connect(address);
                });
            } else {
                var ip = "192.168.1.9";
                //var ip = "localhost";
                var address = "ws://" + ip + ":" + port;
                connect(address);
            }
        });
    </script>
</body>
</html>
